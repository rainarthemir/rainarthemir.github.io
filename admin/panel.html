<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Админка проектов</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
h1 { margin-bottom: 20px; }
#project-form { display: flex; gap: 10px; margin-bottom: 20px; }
#project-form input { padding: 8px; font-size: 16px; }
#buttons { display: flex; flex-direction: column; gap: 10px; width: 400px; }
.project-item { display: flex; align-items: center; justify-content: space-between; padding: 5px; background: #fff; border-radius: 6px; }
.project-name { padding: 6px 10px; border-radius: 6px; color: white; }
button { padding: 5px 10px; cursor: pointer; border-radius: 5px; border: none; background: #0078d4; color: white; transition: 0.2s; }
button:hover { background: #005a9e; }
</style>
</head>
<body>

<h1>Админка проектов</h1>

<div id="project-form">
  <input type="text" id="name" placeholder="Название проекта">
  <input type="color" id="color" value="#0078d4">
  <button id="addBtn">Добавить</button>
</div>

<div id="buttons"></div>

<script>
const API_URL = "https://projects.dmytrothemir.workers.dev/";
const TOKEN = "Bearer SECRET_TOKEN"; // вставь свой токен

async function loadProjects() {
  const container = document.getElementById("buttons");
  container.innerHTML = "";
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    if (!data.success) throw new Error(data.error || "Ошибка загрузки проектов");

    data.projects.forEach(p => {
      const div = document.createElement("div");
      div.className = "project-item";

      const span = document.createElement("span");
      span.textContent = p.name;
      span.className = "project-name";
      span.style.backgroundColor = p.color;

      const editBtn = document.createElement("button");
      editBtn.textContent = "Редактировать";
      editBtn.onclick = () => editProject(p.name);

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Удалить";
      deleteBtn.onclick = () => deleteProject(p.name);

      div.appendChild(span);
      div.appendChild(editBtn);
      div.appendChild(deleteBtn);
      container.appendChild(div);
    });

  } catch (err) {
    container.innerHTML = "Ошибка: " + err.message;
  }
}

async function addProject() {
  const name = document.getElementById("name").value.trim();
  const color = document.getElementById("color").value;
  if (!name) return alert("Введите название");

  const res = await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json", "Authorization": TOKEN },
    body: JSON.stringify({ name, color })
  });
  const result = await res.json();
  if (result.success) {
    document.getElementById("name").value = "";
    loadProjects();
  } else alert(result.error);
}

async function editProject(oldName) {
  const name = prompt("Новое название:", oldName);
  if (!name) return;
  const color = prompt("Новый цвет (hex):", "#0078d4");
  if (!color) return;

  const res = await fetch(API_URL, {
    method: "PUT",
    headers: { "Content-Type": "application/json", "Authorization": TOKEN },
    body: JSON.stringify({ oldName, name, color })
  });
  const result = await res.json();
  if (result.success) loadProjects();
  else alert(result.error);
}

async function deleteProject(name) {
  if (!confirm(`Удалить проект "${name}"?`)) return;
  const res = await fetch(API_URL, {
    method: "DELETE",
    headers: { "Content-Type": "application/json", "Authorization": TOKEN },
    body: JSON.stringify({ name })
  });
  const result = await res.json();
  if (result.success) loadProjects();
  else alert(result.error);
}

document.getElementById("addBtn").addEventListener("click", addProject);

loadProjects();
</script>

</body>
</html>
