<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="panel-container">
  <button id="logoutBtn">Выйти</button>
  <h1>Панель проектов</h1>

  <form id="addProjectForm">
    <input type="text" name="name" placeholder="Название проекта" required>
    <input type="color" name="color" value="#0078d4">
    <button type="submit">Добавить проект</button>
  </form>

  <div id="projects" class="projects"></div>
</div>

<script>
if (localStorage.getItem("loggedIn") !== "true") {
  window.location.href = "login.html";
}

const authToken = localStorage.getItem("authToken");

document.getElementById("logoutBtn").onclick = () => {
  localStorage.removeItem("loggedIn");
  localStorage.removeItem("authToken");
  window.location.href = "login.html";
};

const form = document.getElementById("addProjectForm");
const projectsDiv = document.getElementById("projects");

async function fetchProjects() {
  try {
    const res = await fetch("https://projects.dmytrothemir.workers.dev/", {
      method: "GET",
      headers: { "Authorization": authToken }
    });
    const data = await res.json();
    if (data.success) renderProjects(data.projects);
  } catch (err) {
    console.error(err);
  }
}

function renderProjects(projects) {
  projectsDiv.innerHTML = "";
  projects.forEach(p => {
    const div = document.createElement("div");
    div.className = "project-item";
    div.style.backgroundColor = p.color;
    div.textContent = p.name;

    // Можно добавить редактирование
    div.onclick = () => {
      const newName = prompt("Название", p.name);
      const newColor = prompt("Цвет (hex)", p.color);
      if (newName && newColor) updateProject(p.id, newName, newColor);
    };

    projectsDiv.appendChild(div);
  });
}

async function addProject(name, color) {
  try {
    await fetch("https://projects.dmytrothemir.workers.dev/", {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": authToken },
      body: JSON.stringify({ name, color })
    });
    fetchProjects();
  } catch (err) {
    console.error(err);
  }
}

async function updateProject(id, name, color) {
  try {
    await fetch("https://projects.dmytrothemir.workers.dev/", {
      method: "PUT",
      headers: { "Content-Type": "application/json", "Authorization": authToken },
      body: JSON.stringify({ id, name, color })
    });
    fetchProjects();
  } catch (err) {
    console.error(err);
  }
}

form.onsubmit = (e) => {
  e.preventDefault();
  const name = form.name.value;
  const color = form.color.value;
  addProject(name, color);
  form.reset();
};

// Загрузка проектов при старте
fetchProjects();
</script>
</body>
</html>
